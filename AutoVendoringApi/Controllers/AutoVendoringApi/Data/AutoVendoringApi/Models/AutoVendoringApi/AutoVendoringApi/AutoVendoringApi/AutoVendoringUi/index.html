<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Vendoring - ERP</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f6f8; margin: 20px; }
        h2 { color: #333; }
        .container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 10px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
        button { background: #0078D7; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a9e; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #0078D7; color: white; }
        .success { color: green; margin-top: 10px; }
        .error { color: red; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Vendor Registration</h2>
        <div class="form-group">
            <label>Vendor Name</label>
            <input type="text" id="vendorName" placeholder="Enter vendor name">
        </div>
        <div class="form-group">
            <label>Contact Person</label>
            <input type="text" id="contactPerson">
        </div>
        <div class="form-group">
            <label>Email</label>
            <input type="email" id="email">
        </div>
        <div class="form-group">
            <label>Phone</label>
            <input type="text" id="phone">
        </div>
        <div class="form-group">
            <label>GSTIN</label>
            <input type="text" id="gstin">
        </div>
        <div class="form-group">
            <label>Address</label>
            <textarea id="address"></textarea>
        </div>
        <button id="btnSubmit">Submit Vendor</button>
        <p id="msg"></p>

        <hr>

        <h2>Pending Approvals</h2>
        <table id="tblApprovals">
            <thead>
                <tr>
                    <th>Approval ID</th>
                    <th>Vendor Name</th>
                    <th>Requested By</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        const API_BASE = "https://localhost:5001/api/auto-vendoring"; // replace with Azure API URL after deployment

        $("#btnSubmit").click(function() {
            const vendor = {
                vendorName: $("#vendorName").val(),
                contactPerson: $("#contactPerson").val(),
                email: $("#email").val(),
                phone: $("#phone").val(),
                gstin: $("#gstin").val(),
                address: $("#address").val(),
                createdBy: "demo_user"
            };

            $.ajax({
                url: API_BASE + "/vendors",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(vendor),
                success: function(res) {
                    $("#msg").text("Vendor submitted successfully! ID: " + res.vendor_id).addClass("success");
                },
                error: function(err) {
                    $("#msg").text("Error: " + err.responseJSON?.error).addClass("error");
                }
            });
        });

        function loadApprovals() {
            $.get(API_BASE + "/approvals/pending", function(data) {
                const tbody = $("#tblApprovals tbody");
                tbody.empty();
                data.forEach(row => {
                    const tr = `<tr>
                        <td>${row.ApprovalId}</td>
                        <td>${row.VendorName}</td>
                        <td>${row.RequestedBy}</td>
                        <td>${row.Status || 'pending'}</td>
                        <td>
                            <button onclick="approve(${row.ApprovalId}, true)">Approve</button>
                            <button onclick="approve(${row.ApprovalId}, false)">Reject</button>
                        </td>
                    </tr>`;
                    tbody.append(tr);
                });
            });
        }

        function approve(id, approve) {
            $.ajax({
                url: API_BASE + "/approvals/" + id + "/action",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({ approver: "demo_pm", approve: approve, comments: "" }),
                success: function() { loadApprovals(); },
                error: function() { alert("Action failed"); }
            });
        }

        loadApprovals();
    </script>
</body>
</html>
